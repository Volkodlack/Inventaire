<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="InventPro">
<meta name="theme-color" content="#07090f">
<link rel="stylesheet" href="style.css">
<title>InventPro</title>
</head>
<body>

<header>
  <div class="logo">Invent<span>Pro</span></div>
  <div class="hright">
    <div class="sdot spin" id="sdot" title="Connexion..."></div>
    <div class="hcount" id="hcount">â€”</div>
  </div>
</header>

<div class="tabs">
  <div class="tab on" onclick="goTab('scanner',this)">ğŸ“· Scanner</div>
  <div class="tab" onclick="goTab('inventaire',this)">ğŸ“¦ Inventaire</div>
  <div class="tab" onclick="goTab('export',this)">ğŸ“¤ Export</div>
</div>

<!-- PAGE SCANNER -->
<div class="page on" id="page-scanner">
  <div class="cam-wrap">
    <video id="vid" playsinline autoplay muted></video>
    <div class="overlay" id="scanOverlay" style="display:none">
      <div class="frame">
        <div class="sline"></div>
        <div class="c tl"></div><div class="c tr"></div>
        <div class="c bl"></div><div class="c br"></div>
      </div>
    </div>
    <div class="cam-off" id="camOff">
      <div class="icon">ğŸ“·</div><p>CamÃ©ra inactive</p>
    </div>
  </div>
  <div class="status" id="status">Appuyez sur DÃ©marrer</div>
  <div class="lscan" id="lscan">
    <div class="ls-lbl">Dernier scan</div>
    <div class="ls-row">
      <div class="ls-code" id="lscode"></div>
      <span class="ls-badge" id="lsbadge"></span>
    </div>
    <div class="ls-name" id="lsname"></div>
    <div class="ls-qty" id="lsqty"></div>
  </div>
  <!-- ContrÃ´les camÃ©ra avancÃ©s -->
  <div id="camControls" style="display:none">
    <div id="cameraSelectWrap" style="display:none">
      <label class="cam-ctrl-label">ğŸ”„ Objectif</label>
      <select id="cameraSelect" onchange="switchCamera(this.value)"></select>
    </div>
    <div id="zoomWrap" style="display:none">
      <label class="cam-ctrl-label">ğŸ” Zoom : <span id="zoomVal">1Ã—</span></label>
      <input type="range" id="zoomSlider" min="1" max="5" step="0.1" value="1" oninput="applyZoom(this.value)">
    </div>
  </div>
  <button class="btn bp" id="btnStart" onclick="startCam()">ğŸ“· DÃ©marrer le scanner</button>
  <button class="btn bs" id="btnStop" onclick="stopCam()" style="display:none">â¹ ArrÃªter</button>
  <div class="manual-section">
    <div class="sec-title">Saisie manuelle</div>
    <div class="manual-wrap">
      <input class="manual-input" id="manInput" placeholder="Ex: 3017620422003" type="tel"/>
      <button class="btn bp manualbtn" onclick="manualScan()">âœ”</button>
    </div>
  </div>
</div>

<!-- PAGE INVENTAIRE -->
<div class="page" id="page-inventaire">
  <div class="stats">
    <div class="scard"><div class="sv" id="sref">0</div><div class="sl">RÃ©fÃ©rences</div></div>
    <div class="scard"><div class="sv" id="sqty">0</div><div class="sl">Articles</div></div>
    <div class="scard"><div class="sv" id="sval">0â‚¬</div><div class="sl">Valeur</div></div>
  </div>
  <input class="search" id="search" placeholder="ğŸ” Rechercher..." oninput="renderList()"/>
  <div class="ilist" id="ilist"></div>
</div>

<!-- PAGE EXPORT -->
<div class="page" id="page-export">
  <div class="sec-title">AperÃ§u de l'inventaire</div>
  <div class="tbl-wrap">
    <table>
      <thead>
        <tr><th>CODE</th><th>NOM</th><th>GROUPE</th><th>QTÃ‰</th><th>PRIX â‚¬</th><th>TOTAL â‚¬</th></tr>
      </thead>
      <tbody id="ptbody"></tbody>
    </table>
  </div>
  <div class="sec-title">Exporter</div>
  <input class="einp" id="emailInp" type="email" placeholder="votre@email.com"/>
  <button class="btn bg" onclick="exportMail()">ğŸ“§ Envoyer par mail</button>
  <button class="btn bs" onclick="downloadCSV()">â¬‡ï¸ TÃ©lÃ©charger Excel (.csv)</button>
  <button class="btn br2 danger-btn" onclick="clearAll()">ğŸ—‘ Effacer l'inventaire</button>
</div>

<!-- MODAL NOUVEAU PRODUIT -->
<div class="mover" id="mNew">
  <div class="modal">
    <div class="mhandle"></div>
    <div class="mtit">âœ¨ Nouveau produit</div>
    <div class="msub" id="mNewCode">CODE: â€”</div>
    <div class="fg">
      <label class="flbl">Nom *</label>
      <input class="finp" id="fName" placeholder="Ex: CafÃ© 250g" autocomplete="off"/>
    </div>
    <div class="fg">
      <label class="flbl">Groupe / CatÃ©gorie</label>
      <input class="finp" id="fGroup" placeholder="Ex: Alimentaire" autocomplete="off"/>
    </div>
    <div class="fg">
      <label class="flbl">Prix unitaire (â‚¬)</label>
      <input class="finp" id="fPrice" type="number" step="0.01" min="0" placeholder="0.00"/>
    </div>
    <button class="btn bp" id="btnSaveNew" onclick="saveNew()">âœ… Enregistrer</button>
    <button class="btn bs" onclick="closeM('mNew')">Annuler</button>
  </div>
</div>

<!-- MODAL DETAIL -->
<div class="mover" id="mDetail">
  <div class="modal">
    <div class="mhandle"></div>
    <div class="mtit" id="dName"></div>
    <div class="msub" id="dCode"></div>
    <div class="drow"><span class="dlbl">Groupe</span><span class="dval" id="dGrp">â€”</span></div>
    <div class="drow"><span class="dlbl">Prix unitaire</span><span class="dval" id="dPrc">â€”</span></div>
    <div class="qctrl">
      <button class="qbtn" onclick="chQty(-1)">âˆ’</button>
      <div class="qdisp" id="dQty">0</div>
      <button class="qbtn" onclick="chQty(1)">+</button>
    </div>
    <button class="btn bp" id="btnSaveDet" onclick="saveDet()">ğŸ’¾ Enregistrer</button>
    <button class="btn br2" onclick="delItem()">ğŸ—‘ Supprimer</button>
    <button class="btn bs" onclick="closeM('mDetail')">Fermer</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script src="app.js"></script>
</body>
</html>
